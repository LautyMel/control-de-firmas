<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modificar Lista de Contratados</title>
    <link rel="stylesheet" href="styles2.css">
    <script>
        
      const personas = JSON.parse(localStorage.getItem('personas')) || [ 
    { nombre: 'MARIA CELESTE', apellido: 'ALEANDRO', cuit: '27443662524', gerencia: 'G.O PLANIFICACION', subgerencia: 'SUBGERENCIA OPERATIVA FISCALIZACIÓN Y PLANIFICACIÓN DE CALZADAS' },
    { nombre: 'RODRIGO EMANUEL', apellido: 'ALMONACID', cuit: '20326976092', gerencia: 'G.O OBRAS EN CALZADA', subgerencia: 'G.O OBRAS EN CALZADA' },
    { nombre: 'ALEJANDRO JOSE', apellido: 'AREAL', cuit: '20236699987', gerencia: 'G.O COORDINACION DE PUENTES', subgerencia: 'G.O COORDINACION DE PUENTES' },
    { nombre: 'LEONEL', apellido: 'ARFUSO', cuit: '20426577012', gerencia: 'G.O PLANIFICACION', subgerencia: 'SUBGERENCIA OPERATIVA FISCALIZACIÓN Y PLANIFICACIÓN DE CALZADAS' },
    { nombre: 'SILVINA BEATRIZ', apellido: 'ARGENTO', cuit: '27201854127', gerencia: 'G.O PLANIFICAION', subgerencia: 'SUBGERENCIA OPERATIVA FISCALIZACIÓN Y PLANIFICACIÓN DE CALZADAS' },
    { nombre: 'IGNACIO', apellido: 'ARIAS', cuit: '20359721324', gerencia: 'G.O COORDINACION DE PUENTES', subgerencia: 'G.O COORDINACION DE PUENTES' },
    { nombre: 'MAXIMO', apellido: 'ATENCIO GARCIA', cuit: '20445963810', gerencia: 'G.O OBRAS EN CALZADA', subgerencia: 'G.O OBRAS EN CALZADA' },
    { nombre: 'VICTORIO', apellido: 'BALDINO REINOSO', cuit: '20926532694', gerencia: 'G.O OBRAS EN CALZADA', subgerencia: 'G.O OBRAS EN CALZADA' },
    { nombre: 'SEBASTIAN DANIEL ', apellido: 'BARTUCCI', cuit: '20277381614', gerencia: 'G.O PLANIFICACION', subgerencia: 'SUBGERENCIA OPERATIVA FISCALIZACIÓN Y PLANIFICACIÓN DE CALZADAS' },
    { nombre: 'JORGE ALBERTO', apellido: 'BASSINO', cuit: '20085850750', gerencia: 'G.O PLANIFICACION', subgerencia: 'SUBGERENCIA OPERATIVA FISCALIZACIÓN Y PLANIFICACIÓN DE CALZADAS' },
    { nombre: 'ROMINA ELIZABETH', apellido: 'BAYARRES', cuit: '27402885047', gerencia: 'DIRECCION GENERAL', subgerencia: 'DIRECCION GENERAL' },
  { nombre: 'SEBASTIAN MATIAS', apellido: 'ZAGAGLIA', cuit: '20329968872', gerencia: 'G.O OBRAS EN CALZADA', subgerencia: 'SUBGERENCIA OPERATIVA INSPECCIÓN Y SOPORTE DE EJECUCIÓN' }, 
];

        function renderTable() {
            const table = document.getElementById('personasTable');
            table.innerHTML = '<tr><th>Nombre</th><th>Apellido</th><th>CUIT</th><th>Gerencia</th><th>Subgerencia</th><th>Acciones</th></tr>';
            personas.forEach((persona, index) => {
                const row = table.insertRow();
                row.insertCell(0).innerText = persona.nombre;
                row.insertCell(1).innerText = persona.apellido;
                row.insertCell(2).innerText = persona.cuit;
                row.insertCell(3).innerText = persona.gerencia;
                row.insertCell(4).innerText = persona.subgerencia;
                const actions = row.insertCell(5);
                actions.innerHTML = `<button class="button" onclick="editPersona(${index})">Editar</button> <button class="button" onclick="deletePersona(${index})">Eliminar</button>`;
            });
        }

        function addPersona() {
            const nombre = prompt('Nombre:');
            const apellido = prompt('Apellido:');
            const cuit = prompt('CUIT:');
            const gerencia = prompt('Gerencia:');
            const subgerencia = prompt('Subgerencia:');
            personas.push({ nombre, apellido, cuit, gerencia, subgerencia });
            localStorage.setItem('personas', JSON.stringify(personas));
            renderTable();
            updateSuggestions(nombre, apellido);
        }

        function renderTable() {
    const table = document.getElementById('personasTable');
    table.innerHTML = '<tr><th>Nombre</th><th>Apellido</th><th>CUIT</th><th>Gerencia</th><th>Subgerencia</th><th>Acciones</th></tr>';
    personas.forEach((persona, index) => {
        const row = table.insertRow();
        row.insertCell(0).innerText = persona.nombre;
        row.insertCell(1).innerText = persona.apellido;
        row.insertCell(2).innerText = persona.cuit;
        row.insertCell(3).innerText = persona.gerencia;
        row.insertCell(4).innerText = persona.subgerencia;
        const actions = row.insertCell(5);
        actions.innerHTML = `<button class="button" onclick="editPersona(${index})">Editar</button> <button class="button" onclick="deletePersona(${index})">Eliminar</button>`;
    });
}

function addPersona() {
    // Solicitar el nombre, apellido y cuit a través de prompts
    const nombre = prompt('Ingresar Nombre del Contratado:').toUpperCase();
    const apellido = prompt('Ingresar Apellido del Contratado:').toUpperCase();
    const cuit = prompt('Ingresar CUIT del Contratado:').replace(/[^0-9]/g, '');
    while( cuit.length !==11){
        cuit =  prompt('CUIT Invalido. Por favor, ingrese un CUIT de 11 digitos:', cuit).replace(/[^0-9]/g, '');
    } 
     // Mostrar el modal para elegir Gerencia y Subgerencia
 document.getElementById('selectModal').style.display = 'flex';

    // Guardar la persona con los valores obtenidos hasta ahora (sin gerencia ni subgerencia)
    // Guardamos la persona sin estos dos campos por ahora
  personas.push({ nombre, apellido, cuit, gerencia: "", subgerencia: "" });

    // Guardamos temporalmente el índice de la persona que estamos editando
    // Esto se usará más tarde para actualizar esa persona con las opciones elegidas
  localStorage.setItem('personas', JSON.stringify(personas));
}
function guardarPersona() {
    // Obtener los valores seleccionados de los select
    const gerencia = document.getElementById('gerencia').value;
    const subgerencia = document.getElementById('subgerencia').value;

    // Obtener el último registro añadido 
    const persona = personas[personas.length - 1];

    // Actualizar los valores de Gerencia y Subgerencia
    persona.gerencia = gerencia;
    persona.subgerencia = subgerencia;

    // Guardar la persona actualizada en localStorage
    localStorage.setItem('personas', JSON.stringify(personas));

    // Cerrar el modal y renderizar la tabla nuevamente
    cerrarModal();
    renderTable();
}
function cerrarModal() {
    document.getElementById('selectModal').style.display = 'none';
}


function editPersona(index) {
    const persona = personas[index];
    // Solicitar los datos del usuario y convertir a mayúsculas
    persona.nombre = prompt('Nombre:', persona.nombre).toUpperCase();
    persona.apellido = prompt('Apellido:', persona.apellido).toUpperCase();
    persona.cuit =  prompt('CUIT:', persona.cuit).replace(/[^0-9]/g, '');
    while(persona.cuit.length !==11){
        persona.cuit =  prompt('CUIT Invalido. Por favor, ingrese un CUIT de 11 digitos:', persona.cuit).replace(/[^0-9]/g, '');
    } 
    persona.gerencia = prompt('Gerencia:', persona.gerencia).toUpperCase();
    persona.subgerencia = prompt('Subgerencia:', persona.subgerencia).toUpperCase();

    // Actualizar el array de personas y almacenar en localStorage
    localStorage.setItem('personas', JSON.stringify(personas));
    renderTable();
}

function deletePersona(index) {
    if (confirm('¿Estás seguro de que deseas eliminar esta persona?')) {
        personas.splice(index, 1);
        localStorage.setItem('personas', JSON.stringify(personas));
        renderTable();
    }
}


function updateSuggestions(nombre, apellido) {
    let nombres = JSON.parse(localStorage.getItem('nombres')) || [];
    let apellidos = JSON.parse(localStorage.getItem('apellidos')) || [];

    // Añadir el nombre si no está presente en la lista
    if (!nombres.includes(nombre)) {
        nombres.push(nombre);
        localStorage.setItem('nombres', JSON.stringify(nombres));
    }

    // Añadir el apellido si no está presente en la lista
    if (!apellidos.includes(apellido)) {
        apellidos.push(apellido);
        localStorage.setItem('apellidos', JSON.stringify(apellidos));
    }
}

window.onload = renderTable;

    </script>
</head>
<body>
    <header>
        <div class="logo-container">
            <img src="https://buenosaires.gob.ar/assets/img/logos/LogoBA.svg" alt="Logo Buenos Aires" class="logo">
        </div>
        <div class="title-container">
            <h1>Modificar Lista de Contratados</h1>
        </div>
    </header>

    <button class="button" onclick="window.location.href='index.html';">Volver al formulario</button>
    <button class="button" onclick="addPersona()">Agregar Persona</button>

    <table id="personasTable"></table>
    <button class="button" onclick="window.location.href='index.html';">Volver al formulario</button>
     
    <!-- Modal para seleccionar opciones de Gerencia y Subgerencia -->
<div id="selectModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center; padding: 20px;">
    <div style="background-color:white; padding: 20px; border-radius: 8px; ">
        <h3>SELECCIONAR GERENCIA Y SUBGERENCIA</h3>

        <!-- Formulario de selección -->
        <form id="selectForm">
            <label for="gerencia">Elija Gerencia:</label>
            <select id="gerencia" required>
                <option value="DIRECCION GENERAL">DIRECCION GENERAL</option>
                <option value="G.O COORDINACION DE PUENTES">G.O COORDINACION DE PUENTES</option>
                <option value="G.O OBRAS EN CALZADA">G.O OBRAS EN CALZADA</option>
                <option value="G.O PLANIFICACION">G.O PLANIFICACION</option>
                <option value="G.O SOPORTE ADMINISTRATIVO">G.O SOPORTE ADMINISTRATIVO</option>
               <option value="UNIDAD DE AUDITORIA INTERNA ">  UNIDAD DE AUDITORIA INTERNA </option>
            </select>

            <label for="subgerencia">Elija Subgerencia:</label>
            <select id="subgerencia" required>
                <option value="DIRECCION GENERAL">DIRECCION GENERAL</option>
                <option value="G.O COORDINACION DE PUENTES">G.O COORDINACION DE PUENTES</option>
                <option value="G.O OBRAS EN CALZADA">G.O OBRAS EN CALZADA</option>
                <option value="G.O PLANIFICACION">G.O PLANIFICACION</option>
                <option value="G.O SOPORTE ADMINISTRATIVO">G.O SOPORTE ADMINISTRATIVO</option>
                <option value=" SUBGERENCIA OPERATIVA CERTIFICACIONES"> SUBGERENCIA OPERATIVA CERTIFICACIONES</option>
                <option value="SUBGERENCIA OPERATIVA COMPRAS Y CONTRATACIONES">SUBGERENCIA OPERATIVA COMPRAS Y CONTRATACIONES</option>
                <option value="SUBGERENCIA OPERATIVA CONTABILIDAD Y PATRIMONIO ">SUBGERENCIA OPERATIVA CONTABILIDAD Y PATRIMONIO </option>
              <option value="SUBGERENCIA OPERATIVA DE EMERGENCIAS">SUBGERENCIA OPERATIVA DE EMERGENCIAS</option>
               <option value="SUBGERENCIA OPERATIVA FISCALIZACIÓN Y PLANIFICACIÓN DE CALZADAS">SUBGERENCIA OPERATIVA FISCALIZACIÓN Y PLANIFICACIÓN DE CALZADAS</option>
             <option value="SUBGERENCIA OPERATIVA GESTIÓN DE OBRAS">SUBGERENCIA OPERATIVA GESTIÓN DE OBRAS</option>
             <option value="SUBGERENCIA OPERATIVA INSPECCIÓN Y SOPORTE DE EJECUCIÓN">SUBGERENCIA OPERATIVA INSPECCIÓN Y SOPORTE DE EJECUCIÓN</option>
             <option value="SUBGERENCIA OPERATIVA LEGALES">SUBGERENCIA OPERATIVA LEGALES</option>
             <option value="SUBGERENCIA OPERATIVA MANTENIMIENTO DE PUENTES">SUBGERENCIA OPERATIVA MANTENIMIENTO DE PUENTES</option>
             <option value="SUBGERENCIA OPERATIVA RECLAMOS">SUBGERENCIA OPERATIVA RECLAMOS</option>
             <option value="SUBGERENCIA OPERATIVA RECURSOS HUMANOS">SUBGERENCIA OPERATIVA RECURSOS HUMANOS</option>
             <option value="SUBGERENCIA OPERATIVA SEÑALAMIENTO HORIZONTAL">SUBGERENCIA OPERATIVA SEÑALAMIENTO HORIZONTAL</option>
             <option value="UNIDAD DE AUDITORIA INTERNA">UNIDAD DE AUDITORIA INTERNA</option>
            </select>
          <div  class="button-container">
            <button type="button" onclick="guardarPersona()">Guardar</button>
            <button type="button" onclick="cerrarModal()">Cancelar</button>
          </div>
        </form>
    </div>
</div>

   
    <footer>
        <div class="footer-container">
            <img src="https://badesdeadentro.gob.ar/sites/default/files/2017-08/2017-08-09.png" alt="Logo Buenos Aires" class="footer-image">
        </div>
    </footer>
</body>
</html>
